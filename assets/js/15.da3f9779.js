(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{208:function(t,a,e){"use strict";e.r(a);var r=e(0),s=Object(r.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"wkhtmltopdf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wkhtmltopdf"}},[t._v("#")]),t._v(" wkhtmltopdf")]),t._v(" "),e("h2",{attrs:{id:"一、背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、背景"}},[t._v("#")]),t._v(" 一、背景")]),t._v(" "),e("p",[t._v("公司有基于HMTL代码转PDF文件的需求，使用了一款名为"),e("a",{attrs:{href:"https://github.com/wkhtmltopdf/wkhtmltopdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("wkhtmltopdf"),e("OutboundLink")],1),t._v("的开源软件。但是所使用的0.12.4版本存在一些中文字转换Bug。相关Issues："),e("a",{attrs:{href:"https://github.com/wkhtmltopdf/wkhtmltopdf/issues/2582",target:"_blank",rel:"noopener noreferrer"}},[t._v("Wrong Japanese/Chinese word is converted in bookmarks."),e("OutboundLink")],1),t._v("、"),e("a",{attrs:{href:"https://github.com/wkhtmltopdf/wkhtmltopdf/issues/3841",target:"_blank",rel:"noopener noreferrer"}},[t._v("Incorrect Chinese Characters is converted in PDF outline. "),e("OutboundLink")],1),t._v("。并在上面Issues中找到了解决问题的办法，即修改wkhtmltopdf源码所依赖qt的源码并重新安装。")]),t._v(" "),e("h2",{attrs:{id:"二、解决问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、解决问题"}},[t._v("#")]),t._v(" 二、解决问题")]),t._v(" "),e("h3",{attrs:{id:"_1、下载源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载源码"}},[t._v("#")]),t._v(" 1、下载源码")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone -b "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.12.4'")]),t._v(" git@github.com:wkhtmltopdf/wkhtmltopdf.git --recursive\n")])])]),e("h3",{attrs:{id:"_2、修改qt源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、修改qt源码"}},[t._v("#")]),t._v(" 2、修改qt源码")]),t._v(" "),e("ul",[e("li",[t._v("下载文件"),e("a",{attrs:{href:"https://github.com/wkhtmltopdf/wkhtmltopdf/files/1784597/fixed_incorrect_chinese_characters.patch.txt",target:"_blank",rel:"noopener noreferrer"}},[t._v("fixed_incorrect_chinese_characters.patch.txt"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"language-c++ extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("diff --git a/src/gui/painting/qprintengine_pdf.cpp b/src/gui/painting/qprintengine_pdf.cpp\nindex f6d6e1cc34..862984f6ed 100644\n--- a/src/gui/painting/qprintengine_pdf.cpp\n+++ b/src/gui/painting/qprintengine_pdf.cpp\n@@ -1694,7 +1694,10 @@ void QPdfEnginePrivate::printString(const QString &string) {\n         for(int j=0; j < 2; ++j) {\n             if (part[j] == '(' || part[j] == ')' || part[j] == '\\\\')\n                 array.append('\\\\');\n-            array.append(part[j]);\n+            if (part[j] == '\\r' )\n+                array.append(\"\\\\r\");\n+            else\n+                array.append(part[j]);\n         }\n     }\n     array.append(\")\");\n")])])]),e("ul",[e("li",[t._v("修改源码")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" apply fixed_incorrect_chinese_characters.patch.txt\n")])])]),e("h3",{attrs:{id:"_3、编译源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、编译源码"}},[t._v("#")]),t._v(" 3、编译源码")]),t._v(" "),e("ul",[e("li",[t._v("下载"),e("a",{attrs:{href:"https://github.com/wkhtmltopdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("wkhtmltopdf"),e("OutboundLink")],1),t._v("/"),e("strong",[e("a",{attrs:{href:"https://github.com/wkhtmltopdf/packaging",target:"_blank",rel:"noopener noreferrer"}},[t._v("packaging"),e("OutboundLink")],1)])])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone git@github.com:wkhtmltopdf/packaging.git\n")])])]),e("ul",[e("li",[e("p",[t._v("使用packaging docker编译")]),t._v(" "),e("ul",[e("li",[t._v("构建镜像")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("./build docker-images jessie-amd64\n")])])]),e("ul",[e("li",[t._v("编译")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./build package-docker jessie-amd64 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/wkhtmltopdf\n")])])])])])])}),[],!1,null,null,null);a.default=s.exports}}]);